#!/bin/bash

# Configurable variables
src=html
dest=output
export TEMPLATE_DIR=templates

cd $(git rev-parse --show-toplevel)

if [[ -e .droplet ]]; then
    export HTML_ROOT=""
else
    export HTML_ROOT=$(realpath $dest)
fi

rm -r $dest

for file in $(find $src -type f); do
    out_file=${file/#$src/$dest}
    mkdir -p $(dirname $out_file)
    echo $file
    scripts/parse-file $file > $out_file
done

for dir in res scripts styles; do
    ln -s $PWD/$dir $dest/$dir
done
